<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:_1="http://www.docdatapayments.com/services/paymentservice/1_1/">
   <soapenv:Header/>
   <soapenv:Body>
      <_1:createRequest version="1.1">
         <_1:merchant name="<%= Docdata.username %>" password="<%= Docdata.password %>"/>
         <_1:merchantOrderReference><%= payment.order_reference %></_1:merchantOrderReference>
         <_1:paymentPreferences>
            <_1:profile><%= payment.profile %></_1:profile>
            <_1:numberOfDaysToPay>14</_1:numberOfDaysToPay>
         </_1:paymentPreferences>
         
         <_1:shopper id="<%= shopper.id %>">
            <_1:name>
               <_1:first><%= shopper.first_name %></_1:first>
               <_1:last><%= shopper.last_name %></_1:last>
            </_1:name>
            <_1:email><%= shopper.email %></_1:email>
            <_1:language code="<%= shopper.language_code %>"/>
            <_1:gender>M</_1:gender>
            
         </_1:shopper>
         <_1:totalGrossAmount currency="<%= payment.currency %>"><%= payment.amount %></_1:totalGrossAmount>
         <_1:billTo>
            <_1:name>
               <_1:first><%= shopper.first_name %></_1:first>
               <_1:last><%= shopper.last_name %></_1:last>
            </_1:name>
            <_1:address>
               <_1:street><%= shopper.street %></_1:street>
               <_1:houseNumber><%= shopper.house_number %></_1:houseNumber>
               <_1:postalCode><%= shopper.postal_code %></_1:postalCode>
               <_1:city><%= shopper.city %></_1:city>
               <_1:country code="<%= shopper.country_code %>"/>
            </_1:address>
         </_1:billTo>

         <% if payment.line_items.any? %>
         <_1:invoice>
            <!-- TODO: include VAT options -->
            <!-- <_1:totalNetAmount currency="?">?</_1:totalNetAmount> -->
            <!--1 to 1000 repetitions:-->
            <!-- <_1:totalVatAmount currency="?" rate="?">?</_1:totalVatAmount> -->
            <!--1 to 1000 repetitions:-->
            <% for line_item in payment.line_items %>
            <_1:item number="?">
               <_1:name>?</_1:name>
               <_1:code>?</_1:code>
               <_1:quantity unitOfMeasure="?">?</_1:quantity>
               <_1:description>?</_1:description>
               <!--Optional:-->
               <_1:image>?</_1:image>
               <_1:netAmount currency="?">?</_1:netAmount>
               <_1:grossAmount currency="?">?</_1:grossAmount>
               <_1:vat rate="?">
                  <_1:amount currency="?">?</_1:amount>
               </_1:vat>
               <_1:totalNetAmount currency="?">?</_1:totalNetAmount>
               <_1:totalGrossAmount currency="?">?</_1:totalGrossAmount>
               <_1:totalVat rate="?">
                  <_1:amount currency="?">?</_1:amount>
               </_1:totalVat>
            </_1:item>
            <% end %>
            <_1:shipTo>
               <_1:name>
                  <!--Optional:-->
                  <_1:prefix></_1:prefix>
                  <!--Optional:-->
                  <_1:initials></_1:initials>
                  <_1:first><%= shopper.first_name %></_1:first>
                  <!--Optional:-->
                  <_1:middle></_1:middle>
                  <_1:last><%= shopper.first_name %></_1:last>
                  <!--Optional:-->
                  <_1:suffix></_1:suffix>
               </_1:name>
               <_1:address>
                  <!--Optional:-->
                  <_1:company></_1:company>
                  <_1:street><%= shopper.street %></_1:street>
                  <_1:houseNumber><%= shopper.house_number %></_1:houseNumber>
                  <!--Optional:-->
                  <_1:houseNumberAddition></_1:houseNumberAddition>
                  <_1:postalCode><%= shopper.postal_code %></_1:postalCode>
                  <_1:city><%= shopper.city %></_1:city>
                  <_1:country code="<%= shopper.country_code %>"/>
               </_1:address>
            </_1:shipTo>
            <!--Optional:-->
            <_1:additionalDescription></_1:additionalDescription>
         </_1:invoice>
         <% end %>

      </_1:createRequest>
   </soapenv:Body>
</soapenv:Envelope>